var app = angular.module('ticTacApp', ['firebase']);


app.controller('ticTacCtrl', function($scope, $firebase){

// creates a reference to firebase data. 
var ref = new Firebase("https://leettt.firebaseio.com/board");
var sync = $firebase(ref);
// want to sync board array with firebase
$scope.board = sync.$asArray();

var counterRef = new Firebase("https://leettt.firebaseio.com/counter");
var counterSync = $firebase(counterRef);
$scope.counter = counterSync.$asArray();

// creates empty board object in Firebase with choice property, will keep track of score
$scope.board.$loaded(function () {
  if($scope.board.length === 0) {
    for (var i = 0; i < 9; i++) {
      $scope.board.$add({choice: ''});
    }
  }
});

$scope.counter.$loaded(function(){
   console.log('Counter Loaded');
   if ($scope.counter.length == 0){ 
     $scope.counter.$add({turnNum: 0})
     console.log('Went into if scope counter length = 0.');
   } 
   else {
     $scope.counter[0].turnNum = 0;
     $scope.counter.$save(0); //saves first element in counter
   }

  });

// makeChoice function is attached to ng-click directive. Defines choice as X if turnNumber is even, O if odd. 
  // Populates $scope.board with X or O in row/column specified by div with unique ID generated by $index.
  // Increments turnNumber and runs checkWin function after every click.

  $scope.makeChoice = function(idx) {
    console.log('clicked ' + idx + ' from makeChoice');
    $scope.board[idx].choice = "X";
    $scope.board.$save($scope.board[idx]);
      $scope.turnNumber++;
      // checkWin();
    };
  
// function to check if win conditions are met, will run after every turn. When winner is chosen p1/p2 win function is called.
// function checkWin() {
//   for(i = 0; i < 3; i++)
//   // checks if horizontal rows are equal to each other and not equal to an empty string.
//   if($scope.board[i][0] == $scope.board[i][1] && $scope.board[i][2] == $scope.board[i][0] && $scope.board[i][0] !== "" && $scope.board[i][0] == "X"){
//     console.log("X win horizontal");
//     p1Wins();
//   }
//   else if ($scope.board[i][0] == $scope.board[i][1] && $scope.board[i][2] == $scope.board[i][0] && $scope.board[i][0] !== "" && $scope.board[i][0] == "O"){
//     console.log("O win horizontal");
//     p2Wins();
//   }
//   // checks if vertical columns are equal to each other and not equal to an empty string.
//   else if ($scope.board[0][i] == $scope.board[1][i] && $scope.board[2][i] == $scope.board[0][i] && $scope.board[0][i] !== "" && $scope.board[0][i] == "X") {
//     console.log("X win vertical");
//     p1Wins();
//   }
//   else if ($scope.board[0][i] == $scope.board[1][i] && $scope.board[2][i] == $scope.board[0][i] && $scope.board[0][i] !== "" && $scope.board[0][i] == "O") {
//     console.log("O win vertical");
//     p2Wins();
//   // checks diagonal. only true when i = 0
//   }
//   else if ($scope.board[0][i] == $scope.board[1][i+1] && $scope.board[2][i +2] == $scope.board[0][i] && $scope.board[0][i] !== "" && $scope.board[0][i] == "X") {
//     console.log("X win diagonal right");
//     p1Wins();
//   }
//   else if ($scope.board[0][i] == $scope.board[1][i+1] && $scope.board[2][i +2] == $scope.board[0][i] && $scope.board[0][i] !== "" && $scope.board[0][i] == "O") {
//     console.log("O win diagonal right");
//     p2Wins();
//   }
//   //checks left diagonal. only true when i = 2
//   else if ($scope.board[0][i] == $scope.board[1][i-1] && $scope.board[2][i-2] == $scope.board[0][i] && $scope.board[0][i] !== "" && $scope.board[0][i] == "X") {
//     console.log("X win diagonal left");
//     p1Wins();
//   }
//   else if ($scope.board[0][i] == $scope.board[1][i-1] && $scope.board[2][i-2] == $scope.board[0][i] && $scope.board[0][i] !== "" && $scope.board[0][i] == "O") {
//     console.log("O win diagonal left");
//     p2Wins();
//   }
//   // if turnNumber reaches 9 there's been no winner, tie condition is enforced.
//   else if ($scope.turnNumber == 9) {
//     console.log("TIE");
//   }
// }
  // creates turnNumber property, will get incremented after every turn.
  // $scope.counter = 0;

  

  // $scope.makeChoice = function(row, column) {
  //   if(($scope.board[row][column] == "") && ($scope.turnNumber >=0)) {
  //     var choice = ($scope.turnNumber % 2) == 0 ? "X" : "O";
  //     $scope.board[row][column] = choice;
  //     $scope.turnNumber++;
  //     checkWin(choice);
  //   }
  //   console.log($scope.board);
  // };

  // Win totals increment after p1/p2Wins function is called. 
  $scope.p1WinTotal = 0;
  $scope.p2WinTotal = 0;

  function p1Wins() {
    alert("X Wins!");
    $scope.turnNumber = 0;
    $scope.p1WinTotal++;
  }
  function p2Wins() {
    alert("O Wins!");
    $scope.turnNumber = 0;
    $scope.p2WinTotal++;
  }

  // function clearBoxes() {
  //   for(i = 0;)
  // }


});//end of controller


